# cvflow

![Tests](https://github.com/MLFreelib/cvflow/workflows/Tests/badge.svg)

# Введение

CVFlow - набор алгоритмов на основе компьютерного зрения, предоставляющий,
как запуск готовых примеров, так и настройку собственных.

## Список алгоритмов

<details open>
<summary><b>Определение положения объектов в пространстве и расстояния между ними</b></summary>

### Об алгоритме

    Данный алгоритм на основе двух снимков одной сцены с разных ракурсов определяет расстояние между выделенными 
    пользователем объектами. Особенностью реализации в библиотеке является то, что алгоритм направлен на работу с 
    небольшими объектами. В библиотеке представлено несколько реализаций на основе двух моделей MobileStereoNet и 
    CDN-GaNet.

### Результаты

1) **Расстояние от камер до объектов**


- MobileStereoNet

![MobileStereoNet distance from cameras to objects](readmedata/MobileStereoNetObjectDistance.png)

- CDN-GaNET

![MobileStereoNet distance from cameras to objects](readmedata/CDN-GaNETToObjectDistance.png)

- Полученные измерения

| №   | Высота объекта  | Расстояние до объекта, Метры | Реальное расстояние до объекта, Метры | Ошибка, Миллиметры |
|-----|-----------------|------------------------------|---------------------------------------|--------------------|
| 1   | MobileStereoNet | 0.63                         | 0.6                                   | 30                 |
| 2   | MobileStereoNet | 0.64                         | 0.6                                   | 40                 |
| 3   | MobileStereoNet | 0.68                         | 0.7                                   | 20                 |
| 4   | MobileStereoNet | 0.35                         | 0.25                                  | 100                |
| 5   | CDN-GaNET       | 0.62                         | 0.6                                   | 20                 |
| 6   | CDN-GaNET       | 0.56                         | 0.6                                   | 40                 |
| 7   | CDN-GaNET       | 0.75                         | 0.7                                   | 50                 |
| 8   | CDN-GaNET       | 0.4                          | 0.25                                  | 150                |

---

2) **Расстояние между объектами**

- Пример
  ![Distance between objects](readmedata/DistanceBetweenObjects.jpg)


- Полученные измерения

| №   | Расстояние до объектов, Метры | Предсказанное расстояние между объектами, Миллиметры | Реальное расстояние между объекта, Миллиметры | Ошибка, Миллиметры |
|-----|-------------------------------|------------------------------------------------------|-----------------------------------------------|--------------------|
| 1   | 0.7                           | 113                                                  | 101                                           | 12                 |
| 2   | 0.7                           | 93                                                   | 101                                           | 7                  |
| 3   | 0.6                           | 105                                                  | 100                                           | 5                  |
| 4   | 0.6                           | 94                                                   | 100                                           | 6                  |
| 5   | 0.6                           | 95                                                   | 100                                           | 5                  |

---

3) **Размер объектов**

- Пример

![ObjectsSize](readmedata/ObjectsSize.png)

- Полученные измерения

| №   | Расстояние до объектов, Метры | Предсказанный размер объекта, Миллиметры | Реальный размер объекта, Миллиметры | Ошибка, Миллиметры |
|-----|-------------------------------|------------------------------------------|-------------------------------------|--------------------|
| 1   | 0.3                           | 153                                      | 150                                 | 3                  |
| 2   | 0.35                          | 149                                      | 150                                 | 1                  |
| 3   | 0.25                          | 148                                      | 150                                 | 2                  |
| 4   | 0.3                           | 104                                      | 100                                 | 4                  |
| 5   | 0.35                          | 102                                      | 100                                 | 2                  |
| 6   | 0.25                          | 97                                       | 100                                 | 3                  |

---

</details>

<details open>
<summary><b>Поиск дефектов и прочих образований на материале</b></summary>

### Об алгоритме

    За основу алгоритма взята архитектура SSD300, в которой последний слой классификации был удален,
    а перед слоями по предсказанию сдвигов добавлен слой для для векторного представления каждой
    ограничивающей рамки и на основе функции ошибки TripletLoss создается векторное пространство, которое 
    позволяет без обучения обнаруживать дефекты на различных материалах.

Примеры детекции

![flaw_wood](readmedata/flaw_wood.jpg)
![flaw_steel](readmedata/flaw_steel.jpg)

</details>


<details open>
<summary><b>Распознавание номера автомобилей</b></summary>

### Об алгоритме

    Алгормитм по распозаванию номеров состоит из двух моделей: YOLOv8n для детекции номеров и
    RCNN для распознавания текстовых последовательностей.

### Результаты

1) Детекция, YOLOv8n

- Пример детекции

![Plate detection](readmedata/PlateDetection.png)

2) Распознавание, RCNN

- Пример распознавания

![Plate detection](readmedata/PlateDetection.png)

- Измерения

| Задача                | Train | Test | Valid |
|-----------------------|-------|------|-------|
| Детекция номеров      | -     | -    | 0.99  | 
| Распознавание номеров | -     | -    | -     |
| Цельный алгоритм      | -     | -    | 0.96  |

</details>


<details open>
<summary><b>Распозавание номера вагона поезда</b></summary>

### Об алгоритме

    Разработанный алгоритм обучен на реальных данных в различных условиях окружающей среды и предназначен

для обнаружения и распознавания номеров на вагонах поездов. Для алгоритма использовались архитектура из
распознавания номеров машин.

### Результаты

- Пример детекции

![Plate detection](readmedata/TrainCarsPlateDetection.png)


</details>


<details open>
<summary><b>Распознавание QR и штрихкодов</b></summary>

### Об алгоритме

    На основе OpenCV и zbar построен алгоритм по детекции QR-кодов и их расшифровке.

### Результат

Пример работы алгоритма

![qrcode_example](readmedata/qrcode.jpg)
</details>


<details open>
<summary><b>Классификация трранспортных средств</b></summary>

### Об алгоритме

    Разработанный алгоритм позволяет классифицировать транспортные средства по типу кузова и, таким образом, определять
    их размеры. Это может быть необходимо при анализе поставок на заводах, фильтрации т/с, которые могут угрожать 
    безопасности персонала или при проектировке контрольно-пропускных пунктов, однако использование этого модуля не 
    ограничивается приведёнными ситуациями. Процесс работы модуля продемонстрирован на рисунке 8.1. Точность классификации 
    при IoU 0.5 составила 0,962. 

Пример определения размеров кузова

![car_class1](readmedata/car_classification.jpg)
![car_class2](readmedata/car_classification2.jpg)


</details>


<details open>
<summary><b>Гранулометрия</b></summary>

### Об алгоритме

    Гранулометрический анализ – распределение камней руды по крупности, характеризующееся процентным выходом от массы 
    или количества кусков руды. Алгоритм построен на основе архитектуры UNet, что позволяет достичь
    высокой точности в определении размеров камней на основе масок.

Пример работы алгоритма и сравнение с классическим методом водораздела

![unet](readmedata/gran_unet.jpg)

Измерения


|                |          |         | Точность | Полнота |
|----------------|----------|---------|----------|---------|
| <b>Вычисленное | <b>Камни | <b>Фон  |          |         |
| <b>Камни       | TP = 947 | FP = 56 | 94,4%    | 94,9%   |
| <b>Фон         | FN = 23  | TN = 0  |          |         |


Пример распределения камней на конвейере

![distribution](readmedata/distrib.jpg)



</details>

<details open>
<summary><b>Определения скорости объектов по видеопотоку</b></summary>

### Об алгоритме

    Модуль использует несколько различных алгоритмов компьютерного зрения для подсчёта скорости объекта: нейронную 
    сеть yolov5, состоящую из 367 слоёв и содержащую свыше 46 миллионов параметров, трекер объектов SORT для 
    отслеживания обнаруженных объектов и сравнения положений их центроидов, а также алгоритм расчёта скорости, 
    использующий данные о положениях центроидов, заранее известные размеры объектов (ширина или длина кузова),
    также частоту кадров, размер кадра и свободный параметр, необходимый для более точной калибровки системы. 

Пример работы:

![speed_algo](readmedata/speed.jpg)

Измерения


|                                      | Измерения |
|--------------------------------------|-----------|
| <b>Средняя погрешность               | < 5 км/ч  |
| <b>Скорость работы детектора         | 0.037 c   |
| <b> Полная скорость работы алгоритма | 0.07 c    | 
Измерения проводились на RTX 3090.



</details>

## Веса

    Веса находятся по сссылке в папке в соответствие названию алгоритма: 
<b>[ссылка на веса](google.com)
    
